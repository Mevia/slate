<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Mevia REST API</title>

    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>
  </head>

  <body class="index" data-languages="[&quot;json&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="images/logo.png" alt="Logo" />
        <div class="lang-selector">
              <a href="#" data-language-name="json">JSON</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li><a href='http://www.mevia.se'>Mevia</a></li>
            <li><a href='resources'>Resources</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="overview">Overview</h1>

<p>The API aims to take care of all data related to the MIA module itself, which is sending and receiving information from modules. Developers that use the API can, for instance, obtain all events from a module for a given patient, or register a prescription for a patient which then automatically will set reminders and other logic that interacts with the patient&rsquo;s mobile phone. This page contains general information about the API, what models are available and what the latest changes are. Documentation about all available resources can be found at <a href="resources/">the resource page</a></p>

<p>The purpose of this setup is that API users will be able to concentrate on their business logic, henceforth not on how the modules work, which is abstracted away through the API. A benefit of this is also that, if the physical module changes, then there will be no impact on API users due to this abstraction.</p>

<p>The api is available under <span class="red-text">https://api.mevia.se</span>. Most resources are currently scoped under /v1/.</p>

<h2 id="authentication-and-security">Authentication and security</h2>

<p>All API calls are done via HTTPS requests, which means that all data obtained and retrieved from the API is delivered through an encrypted connection. Moreover, an API key must be sent with each request in order to authorize with the API. The key is used to idenfify which user that is connecting to the API and is initially handed out manually by Mevia.</p>

<p>In order to authorize with the API, the API key must be sent with each request as a request parameter in the request header.</p>

<p>The api key should be specified in the header of every request, in the following fashion:</p>

<p><span class="red-text">Authorization: Token token=&ldquo;API KEY&rdquo;</span></p>

<h2 id="versioning">Versioning</h2>

<h3 id="major-versions-x-y-z">Major Versions(<span class="red-text">x</span>.y.z)</h3>

<p>The major versions will be seperated through API url namespaces, e.g.
https://api.mevia.se/v1/:resource and https://api.mevia.se/v2/:resource</p>

<p>Each major version will be supported as long as API users make use of it.</p>

<h3 id="minor-versions-x-y-z">Minor Versions(x.<span class="red-text">y</span>.z)</h3>

<p>Includes new requirements, improvements and changes that does not affect API users and their interface with the resources they use. The API might add functionality, but does not change or remove existing API resources.</p>

<p>If an API resource is going to change or be removed, it will be marked as &ldquo;depricated&rdquo; long enough for API users to adapt, not breaking any functionality during the transition period for API users.</p>

<h3 id="bug-fixes-x-y-z">Bug Fixes(x.y.<span class="red-text">z</span>)</h3>

<p>Includes bug fixes that doesn&rsquo;t change or functionality to the API, only fix behaviour so it works as expected to.</p>

          <h1 id="flag-types">Flag types</h1>

<p>This is a list of all flags that currently exists in the system. Flags are simply events occuring in the system that users can chose to be notified about.</p>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
<th>When is it sent?</th>
</tr>
</thead><tbody>
<tr>
<td>LOW_BATTERY</td>
<td>A module is low on battery.</td>
<td>When a module has a battery status &lt; 20%</td>
</tr>
<tr>
<td>SEQUENCE_ANOMALY</td>
<td>A pod was taken in the wrong order</td>
<td>When a patient takes a pod that is not the next expected pod</td>
</tr>
<tr>
<td>OUTSIDE_DOSE_INTERVAL</td>
<td>A pod was taken outside of any existing dose</td>
<td>When a patient takes a pod outside of any existing scheduled dose</td>
</tr>
<tr>
<td>ADHERENCE_ANOMALY</td>
<td>Someting went wrong from a adherence perspective</td>
<td>Whenever a adherence-related flag (currently: OUTSIDE_DOSE_INTERVAL and SEQUENCE_ANOMALY) is created.</td>
</tr>
<tr>
<td>DISCONNECTED_DEVICE</td>
<td>A device was disconnected right before user dose started</td>
<td>~30 minutes before start of a dose if user has a disconnected device</td>
</tr>
<tr>
<td>DELAYED_COMMUNICATION</td>
<td>A device failed to communicate for 24.5 hours or more.</td>
<td>Whenever a device has failed to communicate for an entire day (24 hours)</td>
</tr>
</tbody></table>

          <h1 id="notification-types">Notification Types</h1>

<p>This is a list of all existing notifications types. A notification type is set on a notification policy, and is used to know when to create notifications. </p>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
<th>When is the notification sent?</th>
</tr>
</thead><tbody>
<tr>
<td>BEFORE_DOSE_STARTS</td>
<td>Used to create notifications before doses starts</td>
<td>x minutes before the doses start, where x is the minutes variable on the notification policy</td>
</tr>
<tr>
<td>BEFORE_DOSE_ENDS</td>
<td>Used to create notifications before doses ends</td>
<td>x minutes before the doses start, where x is the minutes variable on the notification policy</td>
</tr>
<tr>
<td>AFTER_DOSE_END</td>
<td>Used to create notifications after doses ends</td>
<td>x minutes before the doses ends, where x is the minutes variable on the notification policy</td>
</tr>
</tbody></table>

<p>Example: A notification policy with notification_type: &lsquo;BEFORE_DOSE_ENDS&rsquo; and minutes: 15, and a scheduled_dose_schema with start_time: &#39;10:00&rsquo; and end_time: &#39;11:00&rsquo; will generate a notification that is scheduled to be sent at 10:45 every day that its prescription is active.</p>

          <h1 id="sequencing">Sequencing</h1>

<blockquote>
<p>Example JSON when posting (creating) prescription:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"prescriptions"</span><span class="p">:{</span><span class="w">
    </span><span class="s2">"start_date"</span><span class="p">:</span><span class="s2">"2015-01-01"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"end_date"</span><span class="p">:</span><span class="s2">"2015-03-01"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"pod_sequence"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[1,2,3,4]"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>When creating prescriptions, the API user has the option to create scheduled doses according to a package pod sequence. This means that the patient must take their pods according to a specific sequence on the package (tray), which is represented by numbers. The API, as well as the modules, can handle any kind of sequencing pattern.</p>

<h2 id="practical-assumptions-when-using-sequencing">Practical assumptions when using sequencing</h2>

<blockquote>
<p>Example JSON when retrieving schedule dose which is based on the prescription above:</p>
</blockquote>

<ul>
<li>When taking wrong pods in a sequence, or missing dose completely, the patient moves on to the next set of pods to take for next dose at the next time slot. This means that pods can be untaken when finishing a tray. This does not affect module dose planning, which is very important e.g. for reused modules with set date intervals.</li>
<li>If no sequence is specified for prescriptions and no expected pods are given for scheduled doses, then any pod can be taken at any dose time interval in order to complete them. This is the default behavior.</li>
</ul>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"scheduled_doses"</span><span class="p">:[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="p">:</span><span class="s2">"4744"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"period_starts_at"</span><span class="p">:</span><span class="s2">"2015-03-01T05:00:00.000+00:00"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"period_ends_at"</span><span class="p">:</span><span class="s2">"2015-03-01T12:00:00.000+00:00"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"is_taken"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="s2">"completed_at"</span><span class="p">:</span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="s2">"nr_remaining_pods"</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="w">
      </span><span class="s2">"expected_pods"</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="p">:</span><span class="s2">"4745"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"period_starts_at"</span><span class="p">:</span><span class="s2">"2015-03-01T16:00:00.000+00:00"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"period_ends_at"</span><span class="p">:</span><span class="s2">"2015-03-01T19:00:00.000+00:00"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"is_taken"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="s2">"completed_at"</span><span class="p">:</span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="s2">"nr_remaining_pods"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="w">
      </span><span class="s2">"expected_pods"</span><span class="p">:[</span><span class="mi">4</span><span class="p">]</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="p">:</span><span class="s2">"4746"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"period_starts_at"</span><span class="p">:</span><span class="s2">"2015-03-01T20:00:00.000+00:00"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"period_ends_at"</span><span class="p">:</span><span class="s2">"2015-03-01T22:00:00.000+00:00"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"is_taken"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="s2">"completed_at"</span><span class="p">:</span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="s2">"nr_remaining_pods"</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="w">
      </span><span class="s2">"expected_pods"</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
          <h1 id="releases">Releases</h1>

<h2 id="development-1-9-0">Development - 1.9.0</h2>

<h2 id="staging-1-8-0">Staging - 1.8.0</h2>

<h2 id="production-1-8-0">Production - 1.8.0</h2>

<h3 id="shallow-scopes">Shallow scopes</h3>

<p>All resources under v1/ are now as shallow as at all possible. Scoping is only required for POST and GET(index).</p>

<h3 id="singular-plural-naming">Singular/plural naming</h3>

<p>Resources fetched using SHOW, POST, PUT or DELETE will now use singular naming.</p>

<h3 id="common-filters">Common filters</h3>

<p>All index calls now share some common filters. Available (for all index routes) filters are:
* sort_by
* direction
* offset
* limit</p>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="json">JSON</a>
          </div>
      </div>
    </div>
  </body>
</html>
